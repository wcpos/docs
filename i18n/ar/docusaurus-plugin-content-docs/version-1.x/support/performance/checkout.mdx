---
title: أداء إنهاء الدفع
sidebar_label: أداء إنهاء الدفع
sidebar_position: 1
---

import Image from "@theme/IdealImage";

إذا كنت تعاني من بطء الأداء خلال عملية إنهاء الدفع، ستساعدك هذه الدليل في تحديد وحل أكثر الأسباب شيوعًا.

## كيفية عمل إنهاء الدفع في WCPOS

يفتح إنهاء الدفع في WCPOS نافذة منبثقة تحتوي على iframe/webview يحتوي على نسخة مختصرة من قالب دفع طلبات WooCommerce. هذه في الأساس نفس الصفحة التي يراها العملاء عند الدفع للطلبات عبر الإنترنت [صفحة دفع العملاء](https://woocommerce.com/document/managing-orders/paying-for-orders/#customer-payment-page-link).

:::info ملاحظة المطور
يمكنك عرض قالب إنهاء الدفع في مستودع مكونات WCPOS: [templates/payment.php](https://github.com/wcpos/woocommerce-pos/blob/main/templates/payment.php)
:::

## تحسينات مدمجة

يتضمن WCPOS عدة تحسينات لتحسين أداء إنهاء الدفع:

- **قالب مختصر** - يزيل عناصر التصميم غير الضرورية والفوضى
- **تحميل انتقائي للسكربتات/الأنماط** - يتم تحميل السكربتات والأنماط الأساسية فقط
- **هيكل DOM minimal** - يقلل من تعقيد صفحة إنهاء الدفع

ومع ذلك، لا يمكن تعطيل بعض السكربتات والأنماط تمامًا لأن بوابات الدفع قد تتطلبها للعمل بشكل صحيح.

## مشكلات الأداء الشائعة

### 1. السكربتات والأنماط غير الضرورية

**المشكلة:** تضيف القوالب والمكونات سكربتات وأنماط غير ضرورية لإنهاء الدفع، مما يؤدي إلى بطء تحميل الصفحة.

**الحل:** استخدم [إعدادات إنهاء الدفع](/pos/checkout#checkout-settings-troubleshooting) لتعطيل الموارد غير الضرورية:

1. انقر على زر **إعدادات إنهاء الدفع** في نافذة إنهاء الدفع
2. حاول تعطيل أنماط القالب أولاً:
   - wp-block-library
   - classic-theme-styles
   - أنماط القالب المخصصة الخاصة بك
3. قم بتعطيل السكربتات غير الأساسية لووكوميرس:
   - wc-add-to-cart
   - selectWoo (إذا لم تكن مطلوبة من قبل بوابتك)
   - html5shiv

<div class="image-container">
  <Image
    alt="نموذج لتعطيل جميع الأنماط والسكربتات"
    img="/img/disable-styles-and-scripts.png"
    style={{ maxHeight: 600 }}
  />
  <p class="image-caption">نموذج لتعطيل جميع الأنماط والسكربتات</p>
</div>

:::warning احترس
لا تعطل السكربتات التي تتطلبها بوابة الدفع الخاصة بك. إذا توقفت طريقة الدفع عن العمل بعد تعطيل سكربت، قم بإعادة تفعيله.
:::

### 2. التدخل من المكونات أثناء إنشاء الطلب

**المشكلة:** يمكن أن تؤدي المكونات التي تتعلق بعملية إنشاء الطلب إلى تأخيرات كبيرة. على سبيل المثال، قد ترسل مكونات المحاسبة مثل Xero بيانات الطلب إلى خوادم خارجية، مما يمنع عملية إنهاء الدفع.

**خطوات استكشاف الأخطاء:**

1. **اختبر على بيئة الاختبار** - إذا كان لديك خادم اختبار، قم بتعطيل جميع المكونات باستثناء ووكوميرس وWCPOS
2. **اختبر سرعة إنهاء الدفع** - قم بمعالجة طلب اختبار وراقب الأداء
3. **قم بتمكين المكونات بشكل تدريجي** - إذا تحسن الأداء بشكل كبير، أعد تفعيل المكونات واحدة تلو الأخرى لتحديد الجاني
4. **اتصل بمطوري المكونات** - إذا كان مكون معين يسبب مشكلات، اتصل بالمطور للحصول على نصيحة بشأن التحسين

**أنواع المكونات الشائعة المسببة للمشكلات:**
- تكاملات المحاسبة/المحاسبة (Xero، QuickBooks)
- أدوات التسويق عبر البريد الإلكتروني التي تتسبب في إنشاء الطلب
- أنظمة إدارة المخزون
- حاسبات الشحن المعقدة
- أدوات التحليل من جهة خارجية

### 3. قيود موارد الخادم

**المشكلة:** إذا كان خادمك تحت الحمل أو يفتقر إلى الموارد الكافية، ستصبح جميع العمليات بما في ذلك إنهاء الدفع بطيئة.

**المراقبة وحلول:**

1. **راقب أداء الخادم:**
   - استخدام وحدة المعالجة المركزية خلال إنهاء الدفع
   - استهلاك الذاكرة
   - أداء استعلامات قاعدة البيانات
   - تأخر الشبكة

2. **حسن موارد الخادم:**
   - زيادة حد الذاكرة PHP
   - تحسين استعلامات قاعدة البيانات
   - استخدام مكونات التخزين المؤقت (لكن اختبر التوافق)
   - النظر في ترقية خطة الاستضافة

3. **تحسين قاعدة البيانات:**
   - تنظيف بيانات الطلبات القديمة
   - تحسين جداول قاعدة البيانات
   - إزالة المكونات والقوالب غير الضرورية

## أفضل الممارسات لمطوري WordPress

:::tip للمطورين
يجب على مطوري WordPress استخدام `wp_enqueue_scripts` لإضافة السكربتات والأنماط بشكل صحيح إلى الصفحات. ولكن للأسف، لا يتبع بعض مطوري القوالب والمكونات أفضل الممارسات ويقومون بإدراج الكود مباشرةً في القوالب، مما يجعل من المستحيل إلغاء تحميل هذه الموارد بسهولة.
:::

إذا كنت تواجه مشكلات مع السكربتات أو الأنماط التي لا يمكن تعطيلها من خلال إعدادات إنهاء الدفع:

1. **اتصل بالمطور** - اطلب منهم اتباع معايير الترميز الخاصة بـ WordPress
2. **استخدم قوالب فرعية** - override القوالب المسببة للمشاكل في قالب فرعي
3. **خطاطيف مخصصة** - استخدم خطاطيف WordPress لإزالة الكود المسبب للمشاكل في صفحات إنهاء الدفع

## اختبار الأداء

لاختبار تحسينات أداء إنهاء الدفع:

1. **قياس خط الأساس** - قياس الوقت الذي يستغرقه إنهاء الدفع قبل إجراء تغييرات
2. **قم بإجراء تغيير واحد في كل مرة** - يساعد هذا في تحديد أي التغييرات لها التأثير الأكبر
3. **اختبر مع بوابات الدفع الحقيقية** - لا تختبر فقط مع المدفوعات النقدية
4. **اختبر على أجهزة مختلفة** - قد تظهر الأجهزة المحمولة خصائص أداء مختلفة

## انتصارات سريعة

إليك أكثر تحسينات الأداء فاعلية التي يمكنك إجراؤها:

1. **تعطيل أنماط القالب** - غالبًا ما يوفر أكبر تحسين
2. **إزالة السكربتات غير الضرورية لووكوميرس** - تقلل من وقت تنفيذ JavaScript
3. **تدقيق خطاطيف إنشاء الطلب** - تحديد وتحسين المكونات البطيئة
4. **تحسين الصور** - تأكد من تحسين أي صور في عملية إنهاء الدفع
5. **استخدم مكون مراقبة الأداء** - تتبع التحسينات بمرور الوقت

## متى تطلب المساعدة

اتصل بدعم WCPOS إذا:

- استغرق إنهاء الدفع أكثر من 10 ثوانٍ بشكل مستمر
- لقد اتبعت هذا الدليل لكن لا تزال تواجه مشاكل
- تشك في مكون معين لكن لا يمكنك تحديده
- تحتاج إلى مساعدة في تحسين موارد الخادم

## الوثائق ذات الصلة

- [إعدادات إنهاء الدفع](/pos/checkout#checkout-settings-troubleshooting) - تعطيل السكربتات والأنماط المسببة للمشاكل
- [طرق الدفع](/payment) - تكوين بوابات الدفع لتحقيق الأداء الأمثل
- [استكشاف الأخطاء](/category/troubleshooting) - أدلة استكشاف الأخطاء العامة