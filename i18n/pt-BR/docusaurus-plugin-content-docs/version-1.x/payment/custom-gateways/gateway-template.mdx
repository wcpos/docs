---
title: "Modelo de Gateway"
description: "Crie seu próprio gateway de pagamento personalizado para WooCommerce POS"
---

import FeatureCard from '@site/src/components/FeatureCard';
import FeatureGrid from '@site/src/components/FeatureGrid';

# Modelo de Gateway

O Modelo de Gateway do WooCommerce fornece um ponto de partida para criar seus próprios gateways de pagamento personalizados para WooCommerce POS. Este modelo inclui todo o código base necessário e a estrutura para construir um gateway de pagamento totalmente funcional.

## Recursos

<FeatureGrid>
  <FeatureCard icon="code" title="Modelo Completo">
    Estrutura de gateway pronta para uso com todos os métodos necessários
  </FeatureCard>
  <FeatureCard icon="store" title="Integração com POS">
    Pré-configurado para compatibilidade com WooCommerce POS
  </FeatureCard>
  <FeatureCard icon="terminal" title="Configuração Automatizada">
    Personalização do modelo baseada em script
  </FeatureCard>
  <FeatureCard icon="puzzle-piece" title="Extensível">
    Fácil de modificar e estender para provedores de pagamento específicos
  </FeatureCard>
</FeatureGrid>

## Começando

### Opção 1: Geração Automatizada de Modelo

O modelo inclui um script que personaliza automaticamente o modelo para seu gateway específico:

1. **Clone o Repositório**:
   ```bash
   git clone https://github.com/wcpos/woocommerce-gateway-template.git
   cd woocommerce-gateway-template
   ```

2. **Execute o Script de Configuração**:
   ```bash
   ./create-gateway.sh
   ```

3. **Siga as Instruções**:
   - Digite o nome do seu gateway (por exemplo, "Meu Gateway de Pagamento")
   - Digite um slug do gateway (por exemplo, "meu-pagamento")
   - Forneça uma descrição
   - O script gerará um plugin personalizado

### Opção 2: Uso Manual do Modelo

Se você preferir uma personalização manual:

1. **Baixe o Modelo**:
   - Visite o [repositório do Modelo de Gateway](https://github.com/wcpos/woocommerce-gateway-template)
   - Baixe a versão mais recente ou clone o repositório

2. **Personalize o Modelo**:
   - Substitua `{{GATEWAY_NAME}}` pelo nome de exibição do seu gateway
   - Substitua `{{GATEWAY_SLUG}}` pelo identificador único do seu gateway
   - Substitua `{{GATEWAY_DESCRIPTION}}` pela descrição do seu gateway

3. **Renomeie os Arquivos**:
   - Renomeie `wcpos-{{GATEWAY_SLUG}}.php` para corresponder ao slug do seu gateway
   - Atualize os cabeçalhos de arquivo e informações do plugin

## Estrutura do Modelo

### Arquivo Principal do Plugin

O arquivo principal do plugin (`wcpos-{{GATEWAY_SLUG}}.php`) contém:

- **Cabeçalho do Plugin**: Informações do plugin do WordPress
- **Classe do Gateway**: Classe principal do gateway de pagamento
- **Inicialização**: Configuração do plugin e hooks
- **Integração**: Compatibilidade com WooCommerce POS

### Componentes Principais

**Estrutura da Classe do Gateway**:
```php
class WCPOS_Gateway_{{GATEWAY_CLASS}} extends WC_Payment_Gateway {
    // Gateway configuration
    public function __construct() { }
    
    // Admin settings form
    public function init_form_fields() { }
    
    // Process payment (main logic goes here)
    public function process_payment( $order_id ) { }
    
    // POS-specific methods
    public function payment_fields() { }
}
```

## Guia de Personalização

### Configuração Básica

1. **Informações do Gateway**:
   ```php
   $this->id = 'your_gateway_id';
   $this->title = 'Your Gateway Name';
   $this->description = 'Gateway description for customers';
   $this->method_title = 'Admin title';
   $this->method_description = 'Admin description';
   ```

2. **Recursos Suportados**:
   ```php
   $this->supports = array(
       'products',
       'refunds',
       'subscriptions', // if applicable
   );
   ```

### Processamento de Pagamento

A lógica central de pagamento vai no método `process_payment()`:

```php
public function process_payment( $order_id ) {
    $order = wc_get_order( $order_id );
    
    // Your payment processing logic here
    // Example: API calls, validation, etc.
    
    if ( $payment_successful ) {
        $order->payment_complete();
        return array(
            'result' => 'success',
            'redirect' => $this->get_return_url( $order )
        );
    } else {
        wc_add_notice( 'Payment failed', 'error' );
        return array(
            'result' => 'failure'
        );
    }
}
```

### Configurações do Administrador

Configure as configurações do administrador em `init_form_fields()`:

```php
public function init_form_fields() {
    $this->form_fields = array(
        'enabled' => array(
            'title' => 'Enable/Disable',
            'type' => 'checkbox',
            'label' => 'Enable Your Gateway',
            'default' => 'yes'
        ),
        'api_key' => array(
            'title' => 'API Key',
            'type' => 'text',
            'description' => 'Enter your API key',
            'default' => '',
            'desc_tip' => true,
        ),
        // Add more settings as needed
    );
}
```

### Integração com POS

Para funcionalidades específicas do POS, implemente:

```php
public function payment_fields() {
    // Custom payment form for POS
    if ( is_admin() && isset( $_GET['page'] ) && $_GET['page'] === 'wc-pos' ) {
        // POS-specific payment fields
        echo '<div class="pos-payment-fields">';
        // Your custom POS interface
        echo '</div>';
    } else {
        // Standard web checkout fields
        parent::payment_fields();
    }
}
```

## Melhores Práticas de Desenvolvimento

### Padrões de Código

- **Padrões de Codificação do WordPress**: Siga os padrões de codificação PHP do WordPress
- **Diretrizes do WooCommerce**: Adira às práticas de desenvolvimento do WooCommerce
- **Segurança**: Limpe entradas, valide dados, use nonces
- **Internacionalização**: Torne strings traduzíveis usando `__()` e `_e()`

### Tratamento de Erros

```php
// Proper error handling
try {
    $result = $this->process_api_call( $data );
    if ( is_wp_error( $result ) ) {
        throw new Exception( $result->get_error_message() );
    }
} catch ( Exception $e ) {
    $order->add_order_note( 'Payment failed: ' . $e->getMessage() );
    wc_add_notice( 'Payment processing error', 'error' );
    return array( 'result' => 'failure' );
}
```

### Registro

```php
// Add logging for debugging
if ( $this->debug ) {
    $this->log( 'Payment processing started for order ' . $order_id );
}

private function log( $message ) {
    if ( empty( $this->logger ) ) {
        $this->logger = wc_get_logger();
    }
    $this->logger->info( $message, array( 'source' => $this->id ) );
}
```

## Testando Seu Gateway

### Ambiente de Desenvolvimento

1. **Modo de Teste**: Sempre implemente um modo de teste/sandbox
2. **Registro de Depuração**: Inclua um registro abrangente para resolução de problemas
3. **Cenários de Erro**: Teste várias condições de falha
4. **Teste de POS**: Teste especificamente no ambiente POS

### Casos de Teste

- **Pagamentos Bem-Sucedidos**: Verifique se os pedidos são concluídos corretamente
- **Pagamentos Falhados**: Garanta um tratamento de erro apropriado
- **Reembolsos**: Teste a funcionalidade de reembolso se suportada
- **Casos Limite**: Teste com várias quantidades de pedidos e configurações

## Implantação

### Empacotamento do Plugin

1. **Remova Arquivos de Desenvolvimento**: Limpe arquivos de teste e ferramentas de desenvolvimento
2. **Controle de Versão**: Atualize os números de versão no cabeçalho do plugin
3. **Documentação**: Inclua um README com instruções de instalação
4. **Pacote Zip**: Crie um arquivo zip instalável

### Distribuição

- **Lançamentos do GitHub**: Utilize lançamentos do GitHub para gerenciamento de versões
- **Diretório de Plugins do WordPress**: Considere enviar para o WordPress.org
- **Distribuição Privada**: Hospede em seus próprios servidores, se necessário

## Recursos Avançados

### Webhooks

Para atualizações de pagamento em tempo real:

```php
public function handle_webhook() {
    $payload = file_get_contents( 'php://input' );
    $data = json_decode( $payload, true );
    
    // Verify webhook signature
    if ( $this->verify_webhook_signature( $payload ) ) {
        $this->process_webhook_data( $data );
    }
}
```

### Suporte a Assinaturas

Para pagamentos recorrentes:

```php
// Add subscription support
$this->supports[] = 'subscriptions';
$this->supports[] = 'subscription_cancellation';
$this->supports[] = 'subscription_suspension';
```

### Multi-moeda

Para pagamentos internacionais:

```php
public function get_supported_currencies() {
    return array( 'USD', 'EUR', 'GBP', 'CAD' );
}
```

## Recursos

### Documentação

- [API de Gateway de Pagamento do WooCommerce](https://woocommerce.github.io/code-reference/classes/WC-Payment-Gateway.html)
- [Desenvolvimento de Plugins do WordPress](https://developer.wordpress.org/plugins/)
- [Documentação do WooCommerce POS](https://docs.wcpos.com/)

### Repositório do Template

- **GitHub**: [woocommerce-gateway-template](https://github.com/wcpos/woocommerce-gateway-template)
- **Problemas**: Relate problemas do modelo ou solicite recursos
- **Contribuições**: Envie melhorias via pull requests

### Obtendo Ajuda

Para suporte no desenvolvimento:
- Visite o [repositório do GitHub](https://github.com/wcpos/woocommerce-gateway-template) para questões específicas do modelo
- Consulte a documentação do desenvolvedor do WooCommerce para perguntas sobre a API
- Junte-se à comunidade de desenvolvedores do WooCommerce para orientações gerais

## Exemplos de Gateways

Estude estes gateways personalizados existentes para exemplos de implementação:

- **[Stripe Terminal](./stripe-terminal)**: Exemplo de integração de hardware
- **[SumUp Terminal](./sumup-terminal)**: Integração de terminal baseada em API
- **[Fatura por Email](./email-invoice)**: Gateway simples baseado em email
- **[Checkout Web](./web-checkout)**: Gateway de integração web