---
title: "API04003: 不正なJSONレスポンス"
sidebar_label: API04003
---

# API04003: 不正なJSONレスポンス

## この意味

サーバーはJSONのように見えるデータを返しましたが、破損または無効です。JSONの構文が壊れているため、POSがレスポンスを解析できませんでした。

## 一般的な原因

- **PHPの通知/警告** — JSONの前にPHPの出力がある
- **BOM（バイトオーダーマーク）** — ファイル先頭の不可視文字
- **エンコーディングの問題** — 文字エンコーディングの問題
- **切り捨てられたレスポンス** — 送信中に途中で切断されたレスポンス
- **プラグインの出力** — プラグインが非JSON内容を追加

## 修正方法

### 1. PHPの通知を確認

JSONの前にPHPの通知/警告があると解析が中断されます：

`wp-config.php`で：
```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
```

`wp-content/debug.log`を確認し、問題を修正します。

### 2. BOMキャラクターを確認

一部のテキストエディターは不可視のBOMキャラクターを追加します：
- PHPファイルをBOMなしで再保存
- BOMなしのUTF-8エンコーディングを使用
- 最近編集されたファイルを確認

### 3. レスポンスの完全性を確認

レスポンスが切り捨てられている場合：
- PHPのバッファリング設定を確認
- php.iniの`output_buffering`を増やす
- タイムアウトの問題を確認

### 4. APIを直接テスト

ブラウザーまたはcurlを使用：
```bash
curl -v https://yoursite.com/wp-json/wcpos/v1/
```

JSONの前の予期しないコンテンツを探します。

### 5. 文字エンコーディングを確認

データベースとPHPがUTF-8であることを確認：
- `wp-config.php`の文字セット設定を確認
- データベーステーブルがUTF-8であることを確認
- 問題を引き起こす特殊文字を探す

## 関連エラー

- [API04001](./API04001) — レスポンス形式が無効
- [API04005](./API04005) — JSONリカバリー試行