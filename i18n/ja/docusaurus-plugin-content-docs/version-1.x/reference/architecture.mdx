---
title: アーキテクチャ
sidebar_label: アーキテクチャ
sidebar_position: 2
---

import LocalizedSVG from '@site/src/components/LocalizedSVG';

このページは、開発者と上級ユーザー向けのWCPOSの技術アーキテクチャを説明します。

## 2部構成システム

WCPOSは2部構成のシステムとして設計されています：

1. **PHPプラグイン:** サーバーでホストされる比較的小さなプラグインで、[WooCommerceのREST API](/reference/wc-rest-api)を拡張します。

2. **JavaScriptクライアント:** ブラウザやデスクトップアプリ、後にiOSやAndroidアプリでローカルに実行されます。

2つの異なる世界と考えることができます：

- _PHPの世界_ はWordPressとWooCommerceを使用してデータ管理が行われる場所です。
- _JavaScriptの世界_ はWooCommerceストアをローカルに複製し、高速検索とオフライン使用に最適化されています。

<LocalizedSVG svgName="pos-client-woo-server" />

## データ同期

データは[WooCommerce REST API](https://woocommerce.github.io/woocommerce-rest-api-docs/)を使用してWooCommerceから取得されます。これは、POSがすべての商品、バリエーション、商品カテゴリ、顧客、税率などをローカルに保存するためにダウンロードする必要があることを意味します。

初回は時間がかかる可能性がありますが、一度ダウンロードされれば、サーバーから継続的にフェッチする必要なく、即座に利用可能になります。

### 同期される内容

- 商品とバリエーション
- 商品カテゴリとタグ
- 顧客
- 税率と税クラス
- 決済ゲートウェイ（チェックアウト用）
- 注文（Proの注文履歴用）

### 同期戦略

WCPOSは増分同期戦略を使用します：

1. **初回同期:** 最初の読み込み時にすべてのデータをダウンロード
2. **増分更新:** 最後の同期以降の変更のみをフェッチ
3. **バックグラウンド同期:** 定期的に更新をチェック
4. **手動同期:** ユーザーはいつでも同期をトリガー可能

## アーキテクチャの長所と短所

| 良い点 😊 | 悪い点 😟 |
| ------------------------------------------------------------------ | -------------------------------------------------------- |
| ローカルデータの検索が即時 | データ同期が難しい |
| オフラインで利用可能なキャッシュデータ | WooCommerce REST APIに制限あり |
| デスクトップ、iOS、Androidの優れたネイティブアプリ作成が可能 | WordPressのテーマとフックでPOSアプリをカスタマイズ不可 |

## ローカルデータベース

JavaScriptクライアントはIndexedDB（ブラウザベースのデータベース）にデータを保存します。これにより以下が提供されます：

- **永続性:** データはブラウザの再起動後も保持
- **パフォーマンス:** ネットワーク遅延なしの高速クエリ
- **オフライン閲覧:** インターネットなしでもキャッシュデータにアクセス可能

## チェックアウトアーキテクチャ

チェックアウトプロセスは、WooCommerceの注文支払いページを読み込むiframe/webviewを使用します。このアプローチは：

- **既存の決済ゲートウェイを活用:** WooCommerceのどの決済ゲートウェイもPOSで動作可能
- **セキュリティ維持:** 支払い処理はWooCommerceの安全なインフラストラクチャを通じて実行
- **複雑さ削減:** 決済ゲートウェイ統合を再実装する必要なし

## API拡張

PHPプラグインは、POS固有の機能のための追加エンドポイントでWooCommerce REST APIを拡張します。詳細は[WooCommerce REST API](/reference/wc-rest-api)を参照してください。