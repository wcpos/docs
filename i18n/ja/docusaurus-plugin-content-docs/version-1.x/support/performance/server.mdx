---
title: サーバーパフォーマンス
sidebar_label: サーバーパフォーマンス
sidebar_position: 2
---

import Image from "@theme/IdealImage";

サーバーパフォーマンスは、あなたのWCPOSアプリケーションの速度と応答性に直接影響を与えます。このガイドでは、内蔵のメトリクスとトラブルシューティング技術を使用して、サーバーパフォーマンスを監視、診断、最適化する方法を説明します。

## サーバーメトリクスの理解

WCPOSは、データ取得操作（商品、注文、顧客など）のたびに、自動的にサーバーパフォーマンスメトリクスを収集します。これらのメトリクスは、[ログ](/support/logs)画面で確認できます。

### 一般的なサーバーメトリクス

```json
{
  "total": "24692",
  "execution_time": "76.64 ms",
  "server_load": "[15.20605469,16.16357422,16.76806641]"
}
```

**内訳:**
- **`total`** - 処理されたレコードの数（24,692商品ID）
- **`execution_time`** - 操作を完了するのにかかった時間（76.64ミリ秒）
- **`server_load`** - 1分、5分、15分のサーバーロード平均

## サーバーロードの説明

サーバーロードは、異なる時間におけるシステムの平均負荷を表します。

- **最初の値** - 1分平均（15.21）
- **2番目の値** - 5分平均（16.16）
- **3番目の値** - 15分平均（16.77）

### ロードの解釈

サーバーロードの値は誤解を招く可能性があり、注意して解釈する必要があります：

:::warning ロード値は誤解を招く可能性があります
サーバーロードの平均は、パフォーマンスと直接相関しないことがあります。高いロード値（15+）のサーバーでも、十分なリソースがあり、適切に最適化されていれば非常に応答性が良いことがあります。**ロード値だけでなく、実行時間に焦点を当てましょう。**
:::

**一般的なガイドライン:**
- **CPUコアに対するロード** - 8コアのサーバーでの8.0のロードは、完全な利用を意味します
- **持続的 vs. 一時的** - 短期間のスパイクは正常で、持続的な高負荷は問題を示す場合があります
- **パフォーマンスがもっと重要** - 高いロードを持つ応答性の良いサーバーが、低いロードを持つ遅いサーバーよりも良いです

**注意すべき点:**
- **時間の経過に伴う実行時間の増加**
- **説明なく一貫して増加するロード**
- **高いロードと遅い実行時間の両方が同時に発生する**

## パフォーマンスベンチマーク

### 実行時間ガイドライン

| 操作 | 良好 | 受け入れ可能 | 悪い | 重大 |
|------|------|--------------|------|------|
| **商品取得** | < 100ms | 100-500ms | 500ms-2s | > 2s |
| **注文作成** | < 200ms | 200-800ms | 800ms-3s | > 3s |

### レコード数に関する考慮事項

実行時間はレコード数に応じて合理的にスケーリングされるべきです：

```json
// Good scaling examples
{"total": "100", "execution_time": "15.2 ms"}    // 0.15ms per record
{"total": "1000", "execution_time": "89.4 ms"}   // 0.09ms per record
{"total": "10000", "execution_time": "234.1 ms"} // 0.02ms per record

// Poor scaling examples
{"total": "100", "execution_time": "500.0 ms"}   // 5.0ms per record
{"total": "1000", "execution_time": "8000.0 ms"} // 8.0ms per record
```

## パフォーマンスの問題を診断する

### ステップ1: ログの監視

1. ナビゲーションドロワーから**ログ**を開く
2. 遅い操作を行う（商品を同期する、注文を作成するなど）
3. 対応するログエントリを探す
4. メトリクスを表示するためにコンテキストを展開する

### ステップ2: メトリクスを分析する

**高い実行時間 + 高いサーバーロード = サーバーリソースの問題**
```json
{
  "total": "5000",
  "execution_time": "3500.0 ms",
  "server_load": "[12.45, 11.23, 10.87]"
}
```
*解決策: サーバーリソースを増やすか、サーバー設定を最適化する*

**高い実行時間 + 通常のサーバーロード = プラグイン/データベースの問題**
```json
{
  "total": "1000",
  "execution_time": "2800.0 ms",
  "server_load": "[1.23, 1.45, 1.67]"
}
```
*解決策: 遅いプラグインを特定するか、データベースクエリを最適化する*

**正常な実行時間 + 高いサーバーロード = 一般的なサーバー過負荷**
```json
{
  "total": "2000",
  "execution_time": "150.0 ms",
  "server_load": "[8.90, 9.12, 8.45]"
}
```
*解決策: 他のプロセスからのサーバーロードを減らすか、リソースをアップグレードする*

## 一般的なパフォーマンスの問題

### 1. サーバーリソースの不足

**症状:**
- 一貫して高いサーバーロード（ほとんどのサーバーで> 4.0）
- すべての操作に対して長い実行時間
- 頻繁なタイムアウト

**解決策:**
- **CPUをアップグレード** - より多くのコアが同時リクエストをより良く処理します
- **RAMを増加させる** - ディスクI/Oを減少させ、キャッシュを改善します
- **SSDストレージを使用** - データベースのパフォーマンスが劇的に向上します
- **PHP設定を最適化** - memory_limitやmax_execution_timeを増加させる

### 2. 遅いデータベースクエリ

**症状:**
- 通常のサーバーロードでの高い実行時間
- 特に遅い商品/注文取得
- ログ内のデータベース関連のエラーコード

**解決策:**
- **WooCommerce HPOSを有効にする** - データベースパフォーマンスの最大の改善
- **オブジェクトキャッシングを使用** - 可能であればRedisまたはMemcached
- **WordPressを最新の状態に保つ** - コアの更新には通常データベースの最適化が含まれます
- **投稿のリビジョンを制限する** - `define('WP_POST_REVISIONS', 3);`をwp-config.phpに追加

### 3. プラグインによる干渉

**症状:**
- プラグインの更新後に突然のパフォーマンス低下
- 特定の操作が他のものよりもはるかに遅い
- 通常のサーバーロードでの高い実行時間

**トラブルシューティング:**
1. **ステージングでテスト** - WooCommerceとWCPOS以外のすべてのプラグインを無効にします
2. **ベースラインを測定** - 最小限のプラグインで実行時間を記録します
3. **徐々に有効にする** - プラグインを1つずつ追加して原因を特定します
4. **プラグインフックを確認する** - WooCommerceのアクションにフックしているプラグインを探します

**一般的に問題を引き起こすプラグイン:**
- 商品操作中の重いSEOプラグイン
- 複雑な在庫管理システム
- リアルタイム分析/追跡プラグイン
- 悪いコードのカスタムプラグイン

### 4. WordPress/WooCommerceの設定

**症状:**
- 一貫性のないパフォーマンス
- ログ内のメモリ関連のエラー
- 遅い管理ダッシュボード

**最適化チェックリスト:**
- **PHPバージョン** - より良いパフォーマンスのためにPHP 8.0+を使用
- **WooCommerce HPOS** - 高パフォーマンスの注文ストレージを有効にする（下記参照）
- **WordPressキャッシング** - 可能であればオブジェクトキャッシングを有効にする
- **WooCommerce設定** - 商品画像のサイズを最適化する

### WooCommerce高パフォーマンス注文ストレージ（HPOS）

:::tip 最大のパフォーマンス向上
**HPOSはWooCommerceのパフォーマンス改善の中で最も重要なものの一つです。** これは、WordPressの投稿テーブルの代わりにカスタムデータベーステーブルに注文を保存し、多くの注文を持つ店舗のパフォーマンスを劇的に向上させます。
:::

**利点:**
- **高速な注文クエリ** - 最適化されたデータベース構造に保存された注文
- **データベース負荷の軽減** - 投稿/ページから注文を分離
- **より優れたスケーラビリティ** - 大量の注文を効率的に処理
- **管理パフォーマンスの改善** - より迅速な注文管理画面

**有効化方法:**
1. `WooCommerce > 設定 > 高度な設定 > 機能`に移動
2. 「高パフォーマンスの注文ストレージ」を有効にする
3. マイグレーションプロセスに従う

**詳細を学ぶ:**
- [WooCommerce HPOSドキュメント](https://woocommerce.com/document/high-performance-order-storage/)
- [HPOSマイグレーションガイド](https://woocommerce.com/document/high-performance-order-storage/#section-3)

## サーバー監視のベストプラクティス

### 1. 定期的なパフォーマンスチェック

- **週次レビュー** - パフォーマンストレンドのためにログを確認
- **ベースライン測定** - 通常の実行時間を記録
- **ピーク時の監視** - 高トラフィックの期間中に監視

### 2. パフォーマンスアラートの設定

以下の警告兆候を監視します：
- 実行時間が1000msを超えている
- サーバーロードが5.0を超えている
- ログ内の頻繁なタイムアウトエラー

### 3. キャパシティプランニング

成長トレンドを追跡します：
- **レコード数の成長** - 商品、注文、顧客
- **パフォーマンスの悪化** - 実行時間のスケーリング
- **リソース利用状況** - CPU、メモリ、ディスク使用量

## サーバー最適化戦略

### 1. WordPress/WooCommerceのベストプラクティス

**HPOSを有効にする:**
- WooCommerceにとって最も影響力のあるパフォーマンス改善
- 詳細は上記のHPOSセクションを参照

**PHP設定（ホストに確認）:**
```ini
memory_limit = 512M
max_execution_time = 300
max_input_vars = 3000
```

**WordPressの設定:**
```php
// In wp-config.php - limit post revisions
define('WP_POST_REVISIONS', 3);

// Enable WordPress debug logging if needed
define('WP_DEBUG_LOG', true);
```

### 2. ホスティングレベルの最適化

**オブジェクトキャッシング:**
- ホストにRedisまたはMemcachedの可用性について尋ねる
- 多くの管理されたWordPressホストはこれを自動的に提供します

**PHPバージョン:**
- 重要なパフォーマンス向上のためにPHP 8.0+を使用
- ほとんどのホストは簡単なPHPバージョン切り替えを許可しています

**サーバーリソース:**
- 適切なRAMを確保します（最小1GB、推奨2GB以上）
- SSDストレージは、従来のドライブよりもはるかに良いデータベースパフォーマンスを提供します

## いつ助けを求めるべきか

次の場合はホスティングプロバイダーやWordPress開発者に連絡してください：

- **サーバーロードが一貫して> 8.0** 最適化の努力にもかかわらず
- **実行時間が> 5000ms** 簡単な操作で
- ログに**メモリエラー**が頻繁に現れる
- **データベースクエリが> 2秒かかる** 一貫して

次を提供してください：
- ログからのサーバーメトリクス
- アクティブなプラグインの一覧
- サーバー仕様（CPU、RAM、ストレージタイプ）
- WordPressとWooCommerceのバージョン

## 関連文書

- [ログ](/support/logs) - サーバーメトリクスのアクセスと解釈方法
- [チェックアウトパフォーマンス](/support/performance/checkout) - 支払い処理の最適化
- [エラーコード](/error-codes) - パフォーマンス関連のエラーコードの理解
- [トラブルシューティング](/category/troubleshooting) - 一般的なトラブルシューティングガイド