---
title: チェックアウトパフォーマンス
sidebar_label: チェックアウトパフォーマンス
sidebar_position: 1
---

import Image from "@theme/IdealImage";

チェックアウトプロセス中にパフォーマンスが遅くなっている場合、このガイドは最も一般的な原因を特定し、解決するお手伝いをします。

## WCPOSのチェックアウトの仕組み

WCPOSのチェックアウトは、WooCommerceの注文支払いテンプレートの簡素化されたバージョンを読み込むiframe/webviewのあるモーダルを開きます。これは、顧客がオンラインで注文を支払うときに表示される[顧客支払いページ](https://woocommerce.com/document/managing-orders/paying-for-orders/#customer-payment-page-link)と本質的に同じページです。

:::info 開発者向けノート
WCPOSプラグインリポジトリでチェックアウトテンプレートを表示できます: [templates/payment.php](https://github.com/wcpos/woocommerce-pos/blob/main/templates/payment.php)
:::

## 組み込みの最適化

WCPOSはチェックアウトパフォーマンスを改善するためにいくつかの最適化を含んでいます：

- **簡素化されたテンプレート** - 不要なテーマ要素や混乱を排除
- **選択的なスクリプト/スタイルの読み込み** - 必要なスクリプトとスタイルのみを読み込む
- **最小限のDOM構造** - チェックアウトページの複雑さを削減

ただし、ペイメントゲートウェイが適切に機能するために必要な場合があるため、いくつかのスクリプトやスタイルは完全に無効にすることはできません。

## 一般的なパフォーマンスの問題

### 1. 不要なスクリプトとスタイル

**問題:** テーマやプラグインがチェックアウトに必要ないスクリプトやスタイルを追加し、ページの読み込み時間を遅らせます。

**解決策:** [チェックアウト設定](/pos/checkout#checkout-settings-troubleshooting)を使用して不要なリソースを無効にします：

1. チェックアウトモーダルで**チェックアウト設定**ボタンをクリック
2. まずテーマスタイルを無効にしてみてください：
   - wp-block-library
   - classic-theme-styles
   - あなたのテーマのカスタムスタイル
3. 非必須のWooCommerceスクリプトを無効にします：
   - wc-add-to-cart
   - selectWoo (ゲートウェイに必要ない場合)
   - html5shiv

<div class="image-container">
  <Image
    alt="すべてのスタイルとスクリプトを無効にするためのフォーム"
    img="/img/disable-styles-and-scripts.png"
    style={{ maxHeight: 600 }}
  />
  <p class="image-caption">すべてのスタイルとスクリプトを無効にするためのフォーム</p>
</div>

:::warning 注意
ペイメントゲートウェイに必要なスクリプトは無効にしないでください。スクリプトを無効にした後に支払い方法が動作しなくなった場合は、再度有効にしてください。
:::

### 2. 注文作成中のプラグイン干渉

**問題:** 注文作成プロセスにフックするプラグインは、重大な遅延を引き起こす可能性があります。例えば、Xeroのような会計プラグインは、注文データを外部サーバーに送信するため、チェックアウトプロセスをブロックすることがあります。

**トラブルシューティング手順:**

1. **ステージングでテスト** - ステージングサーバーがある場合、WooCommerceとWCPOS以外のすべてのプラグインを無効にします
2. **チェックアウト速度をテスト** - テスト注文を処理し、パフォーマンスを記録します
3. **プラグインを徐々に有効に** - パフォーマンスが劇的に改善した場合、問題を特定するために一つずつプラグインを再度有効にします
4. **プラグイン開発者に連絡** - 特定のプラグインが問題を引き起こしている場合、最適化のアドバイスを求めます

**一般的な問題のあるプラグインの種類:**
- 会計/簿記の統合（Xero、QuickBooks）
- 注文作成時に発生するメールマーケティングツール
- 在庫管理システム
- 複雑な配送計算機
- サードパーティの分析ツール

### 3. サーバーリソースの制限

**問題:** サーバーが負荷に耐えていないか、十分なリソースが不足している場合、チェックアウトを含むすべての操作が遅くなります。

**監視と解決策:**

1. **サーバーパフォーマンスを監視:**
   - チェックアウト中のCPU使用率
   - メモリ消費量
   - データベースクエリのパフォーマンス
   - ネットワーク遅延

2. **サーバーリソースを最適化:**
   - PHPメモリ制限を増やす
   - データベースクエリを最適化
   - キャッシュプラグインを使用（互換性をテスト）
   - ホスティングプランのアップグレードを検討

3. **データベースの最適化:**
   - 古い注文データをクリーンアップ
   - データベーステーブルを最適化
   - 不要なプラグインやテーマを削除

## WordPress開発者のベストプラクティス

:::tip 開発者向け
WordPress開発者は、`wp_enqueue_scripts`を使用してスクリプトやスタイルをページに適切に追加するべきです。残念ながら、一部のプラグインおよびテーマ開発者はベストプラクティスに従わず、テンプレートに直接コードを挿入するため、これらのリソースを簡単に無効にすることができなくなっています。
:::

チェックアウト設定を通じて無効にできないスクリプトやスタイルに問題がある場合：

1. **開発者に連絡** - WordPressコーディングスタンダードに従うように依頼
2. **子テーマを使用** - 子テーマで問題のあるテンプレートをオーバーライド
3. **カスタムフック** - WordPressフックを使用してチェックアウトページの問題のあるコードを削除

## パフォーマンステスト

チェックアウトパフォーマンスの改善をテストするには：

1. **基準測定** - 変更前にチェックアウトにかかる時間を計測
2. **一度に一つの変更を行う** - これにより影響が最も大きい変更を特定できます
3. **実際のペイメントゲートウェイでテスト** - 現金払いだけでなくテスト
4. **異なるデバイスでテスト** - モバイルデバイスは異なるパフォーマンス特性を示す場合があります

## クイックウィン

以下は、最も効果的なパフォーマンス改善策です：

1. **テーマスタイルを無効にする** - 最も大きな改善が得られることが多い
2. **不要なWooCommerceスクリプトを削除する** - JavaScriptの実行時間を短縮
3. **注文作成フックを監査する** - 遅いプラグインを特定し最適化
4. **画像を最適化する** - チェックアウト内の画像を最適化
5. **パフォーマンス監視プラグインを使用する** - 時間の経過に伴う改善を追跡

## いつ助けを求めるべきか

以下の場合はWCPOSサポートに連絡してください：

- チェックアウトが一貫して10秒以上かかる
- このガイドに従ったが依然として問題がある
- 特定のプラグインが疑わしいが特定できない
- サーバーリソースの最適化に関して助けが必要

## 関連文書

- [チェックアウト設定](/pos/checkout#checkout-settings-troubleshooting) - 問題のあるスクリプトとスタイルを無効にする
- [支払い方法](/payment) - 最適なパフォーマンスのためにペイメントゲートウェイを設定する
- [トラブルシューティング](/category/troubleshooting) - 一般的なトラブルシューティングガイド

---