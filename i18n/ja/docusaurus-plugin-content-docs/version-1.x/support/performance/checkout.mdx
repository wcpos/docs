---
title: チェックアウトパフォーマンス
sidebar_label: チェックアウトパフォーマンス
sidebar_position: 1
---

import Image from "@theme/IdealImage";

チェックアウトプロセス中にパフォーマンスが遅いと感じている場合、このガイドは最も一般的な原因を特定し解決するのに役立ちます。

## WCPOSチェックアウトの仕組み

WCPOSのチェックアウトは、WooCommerce Order Payテンプレートの簡略化されたバージョンを読み込むiframe/webviewを持つモーダルを開きます。これは、顧客がオンラインで注文を支払う際に見る[顧客支払いページ](https://woocommerce.com/document/managing-orders/paying-for-orders/#customer-payment-page-link)と基本的に同じページです。

:::info 開発者ノート
WCPOSプラグインリポジトリでチェックアウトテンプレートを確認できます: [templates/payment.php](https://github.com/wcpos/woocommerce-pos/blob/main/templates/payment.php)
:::

## 内蔵の最適化

WCPOSには、チェックアウトパフォーマンスを改善するためのいくつかの最適化が含まれています：

- **簡略化されたテンプレート** - 不要なテーマ要素や雑音を排除
- **選択的スクリプト/スタイルの読み込み** - 必要なスクリプトとスタイルのみを読み込み
- **最小限のDOM構造** - チェックアウトページの複雑さを減少

ただし、いくつかのスクリプトとスタイルは、決済ゲートウェイが正常に機能するために必要なため、完全には無効化できません。

## 一般的なパフォーマンス問題

### 1. 不要なスクリプトとスタイル

**問題:** テーマやプラグインが、チェックアウトに必要ないスクリプトやスタイルを追加し、ページの読み込み時間を遅くしている。

**解決策:** [チェックアウト設定](/pos/checkout#checkout-settings-troubleshooting)を使用して不要なリソースを無効にします：

1. チェックアウトモーダルで**チェックアウト設定**ボタンをクリック
2. 最初にテーマスタイルを無効にしてみてください：
   - wp-block-library
   - classic-theme-styles
   - あなたのテーマのカスタムスタイル
3. 非必須のWooCommerceスクリプトを無効にします：
   - wc-add-to-cart
   - selectWoo（ゲートウェイには必要ない場合）
   - html5shiv

<div class="image-container">
  <Image
    alt="すべてのスタイルとスクリプトを無効にするフォーム"
    img="/img/disable-styles-and-scripts.png"
    style={{ maxHeight: 600 }}
  />
  <p class="image-caption">すべてのスタイルとスクリプトを無効にするフォーム</p>
</div>

:::warning 注意
あなたの決済ゲートウェイが必要とするスクリプトを無効にしないでください。スクリプトを無効にした後に支払い方法が機能しなくなった場合は、それを再度有効にしてください。
:::

### 2. 注文作成中のプラグイン干渉

**問題:** 注文作成プロセスにフックするプラグインが、著しい遅延を引き起こす可能性があります。たとえば、Xeroのような会計プラグインは注文データを外部サーバーに送信し、チェックアウトプロセスを妨げる可能性があります。

**トラブルシューティングステップ:**

1. **ステージングでテスト** - ステージングサーバーがある場合、WooCommerceとWCPOSを除くすべてのプラグインを無効にします
2. **チェックアウト速度をテスト** - テスト注文を処理してパフォーマンスを記録します
3. **プラグインを徐々に有効化** - パフォーマンスが劇的に改善される場合、問題のプラグインをひとつずつ再有効化して特定します
4. **プラグイン開発者に連絡** - 特定のプラグインが問題を引き起こしている場合、最適化のアドバイスを求めます

**一般的に問題となるプラグインの種類:**
- 会計/簿記統合（Xero、QuickBooks）
- 注文作成時にトリガーされるメールマーケティングツール
- 在庫管理システム
- 複雑な配送計算機
- サードパーティの分析ツール

### 3. サーバーリソースの制限

**問題:** サーバーが負荷を受けているか、十分なリソースがない場合、すべての操作（チェックアウトを含む）が遅くなります。

**監視と解決策：**

1. **サーバーパフォーマンスを監視:**
   - チェックアウト中のCPU使用率
   - メモリ消費量
   - データベースクエリパフォーマンス
   - ネットワーク遅延

2. **サーバーリソースを最適化:**
   - PHPメモリ制限を増加
   - データベースクエリを最適化
   - キャッシングプラグインを利用（ただし、互換性をテスト）
   - ホスティングプランのアップグレードを検討

3. **データベース最適化:**
   - 古い注文データをクリーンアップ
   - データベーステーブルを最適化
   - 不要なプラグインとテーマを削除

## WordPress開発者のベストプラクティス

:::tip 開発者向け
WordPressの開発者は、ページにスクリプトやスタイルを正しく追加するために`wp_enqueue_scripts`を使用すべきです。しかし、残念ながら一部のプラグインやテーマの開発者はベストプラクティスに従わず、コードを直接テンプレートに挿入するため、これらのリソースを簡単に無効化することができません。
:::

スクリプトやスタイルがチェックアウト設定を通じて無効にできない場合：

1. **開発者に連絡** - 彼らにWordPressコーディングスタンダードに従うようお願いする
2. **子テーマを使用** - 子テーマで問題のあるテンプレートをオーバーライド
3. **カスタムフック** - WordPressフックを使用してチェックアウトページの問題のあるコードを削除

## パフォーマンステスト

チェックアウトパフォーマンス改善をテストするには：

1. **ベースライン測定** - 変更前にチェックアウトにかかる時間を測定
2. **一度に一つの変更を行う** - これにより、どの変更が最も影響を与えるかを特定できます
3. **実際の決済ゲートウェイでテスト** - 現金払いだけでなくテストする
4. **異なるデバイスでテスト** - モバイルデバイスは異なるパフォーマンス特性を示す可能性があります

## 効率的な改善策

以下は、最も効果的なパフォーマンス向上策です：

1. **テーマスタイルを無効にする** - しばしば最大の改善が得られます
2. **不要なWooCommerceスクリプトを削除する** - JavaScriptの実行時間を減少
3. **注文作成フックを監査** - 遅いプラグインを特定し最適化
4. **画像を最適化** - チェックアウトに含まれる画像が最適化されているか確認
5. **パフォーマンス監視プラグインを使用** - 時間をかけた改善を追跡

## いつ助けを求めるか

次のような場合はWCPOSサポートに連絡してください：

- チェックアウトが常に10秒以上かかる
- このガイドに従ったが、まだ問題がある
- 特定のプラグインを疑っているが特定できない
- サーバーリソースの最適化の手助けが必要

## 関連ドキュメント

- [チェックアウト設定](/pos/checkout#checkout-settings-troubleshooting) - 問題のあるスクリプトとスタイルを無効にする
- [支払い方法](/payment) - 最適なパフォーマンスのために決済ゲートウェイを設定
- [トラブルシューティング](/category/troubleshooting) - 一般的なトラブルシューティングガイド