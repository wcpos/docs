---
title: Gateway-Vorlage
description: Erstellen Sie Ihr eigenes benutzerdefiniertes WooCommerce POS-Zahlungsgateway
---

import FeatureCard from '@site/src/components/FeatureCard';
import FeatureGrid from '@site/src/components/FeatureGrid';

# Gateway-Vorlage

Die WooCommerce Gateway-Vorlage bietet einen Ausgangspunkt zum Erstellen Ihrer eigenen benutzerdefinierten Zahlungsgateways für WooCommerce POS. Diese Vorlage enthält gesamten erforderlichen Boilerplate-Code und die Struktur, um ein voll funktionsfähiges Zahlungsgateway zu erstellen.

## Funktionen

<FeatureGrid>
  <FeatureCard icon="code" title="Komplette Vorlage">
    Fertige Gateway-Struktur mit allen erforderlichen Methoden
  </FeatureCard>
  <FeatureCard icon="store" title="POS-Integration">
    Vorgekonfiguriert für WooCommerce POS-Kompatibilität
  </FeatureCard>
  <FeatureCard icon="terminal" title="Automatisierte Einrichtung">
    Skriptbasierte Vorlagenanpassung
  </FeatureCard>
  <FeatureCard icon="puzzle-piece" title="Erweiterbar">
    Einfach zu modifizieren und für spezifische Zahlungsanbieter zu erweitern
  </FeatureCard>
</FeatureGrid>

## Erste Schritte

### Option 1: Automatisierte Vorlagenerstellung

Die Vorlage enthält ein Skript, das die Vorlage automatisch für Ihr spezifisches Gateway anpasst:

1. **Klone das Repository**:
   ```bash
   git clone https://github.com/wcpos/woocommerce-gateway-template.git
   cd woocommerce-gateway-template
   ```

2. **Führen Sie das Setup-Skript aus**:
   ```bash
   ./create-gateway.sh
   ```

3. **Folgen Sie den Eingabeaufforderungen**:
   - Geben Sie den Namen Ihres Gateways ein (z. B. "Mein Zahlungsgateway")
   - Geben Sie einen Gateway-Slug ein (z. B. "mein-zahlungsgateway")
   - Geben Sie eine Beschreibung ein
   - Das Skript generiert ein angepasstes Plugin

### Option 2: Manuelle Verwendung der Vorlage

Wenn Sie eine manuelle Anpassung bevorzugen:

1. **Laden Sie die Vorlage herunter**:
   - Besuchen Sie das [Gateway-Vorlagen-Repository](https://github.com/wcpos/woocommerce-gateway-template)
   - Laden Sie die neueste Version herunter oder klonen Sie das Repository

2. **Passen Sie die Vorlage an**:
   - Ersetzen Sie `{{GATEWAY_NAME}}` durch den angezeigten Namen Ihres Gateways
   - Ersetzen Sie `{{GATEWAY_SLUG}}` durch die eindeutige Kennung Ihres Gateways
   - Ersetzen Sie `{{GATEWAY_DESCRIPTION}}` durch die Beschreibung Ihres Gateways

3. **Dateien umbenennen**:
   - Benennen Sie `wcpos-{{GATEWAY_SLUG}}.php` um, um Ihren Gateway-Slug zu entsprechen
   - Aktualisieren Sie Dateiköpfe und Plugin-Informationen

## Vorlagenstruktur

### Haupt-Plugin-Datei

Die Haupt-Plugin-Datei (`wcpos-{{GATEWAY_SLUG}}.php`) enthält:

- **Plugin-Header**: Informationen zum WordPress-Plugin
- **Gateway-Klasse**: Hauptklasse des Zahlungsgateways
- **Initialisierung**: Plugin-Einrichtung und Hooks
- **Integration**: WooCommerce POS-Kompatibilität

### Schlüsselkonstrukte

**Gateway-Klassenstruktur**:
```php
class WCPOS_Gateway_{{GATEWAY_CLASS}} extends WC_Payment_Gateway {
    // Gateway configuration
    public function __construct() { }
    
    // Admin settings form
    public function init_form_fields() { }
    
    // Process payment (main logic goes here)
    public function process_payment( $order_id ) { }
    
    // POS-specific methods
    public function payment_fields() { }
}
```

## Anpassungsleitfaden

### Grundkonfiguration

1. **Gateway-Informationen**:
   ```php
   $this->id = 'your_gateway_id';
   $this->title = 'Your Gateway Name';
   $this->description = 'Gateway description for customers';
   $this->method_title = 'Admin title';
   $this->method_description = 'Admin description';
   ```

2. **Unterstützte Funktionen**:
   ```php
   $this->supports = array(
       'products',
       'refunds',
       'subscriptions', // if applicable
   );
   ```

### Zahlungsabwicklung

Die Kernzahlungslogik kommt in die Methode `process_payment()`:

```php
public function process_payment( $order_id ) {
    $order = wc_get_order( $order_id );
    
    // Your payment processing logic here
    // Example: API calls, validation, etc.
    
    if ( $payment_successful ) {
        $order->payment_complete();
        return array(
            'result' => 'success',
            'redirect' => $this->get_return_url( $order )
        );
    } else {
        wc_add_notice( 'Payment failed', 'error' );
        return array(
            'result' => 'failure'
        );
    }
}
```

### Admin-Einstellungen

Konfigurieren Sie die Admin-Einstellungen in `init_form_fields()`:

```php
public function init_form_fields() {
    $this->form_fields = array(
        'enabled' => array(
            'title' => 'Enable/Disable',
            'type' => 'checkbox',
            'label' => 'Enable Your Gateway',
            'default' => 'yes'
        ),
        'api_key' => array(
            'title' => 'API Key',
            'type' => 'text',
            'description' => 'Enter your API key',
            'default' => '',
            'desc_tip' => true,
        ),
        // Add more settings as needed
    );
}
```

### POS-Integration

Für POS-spezifische Funktionen implementieren Sie:

```php
public function payment_fields() {
    // Custom payment form for POS
    if ( is_admin() && isset( $_GET['page'] ) && $_GET['page'] === 'wc-pos' ) {
        // POS-specific payment fields
        echo '<div class="pos-payment-fields">';
        // Your custom POS interface
        echo '</div>';
    } else {
        // Standard web checkout fields
        parent::payment_fields();
    }
}
```

## Entwicklungsbest Practices

### Code-Standards

- **WordPress-Coding-Standards**: Folgen Sie den PHP-Coding-Standards von WordPress
- **WooCommerce-Richtlinien**: Halten Sie die Entwicklungspraktiken von WooCommerce ein
- **Sicherheit**: Sanitär Eingaben, Daten validieren, Nonces verwenden
- **Internationalisierung**: Machen Sie Zeichenfolgen übersetzbar mit `__()` und `_e()`

### Fehlerbehandlung

```php
// Proper error handling
try {
    $result = $this->process_api_call( $data );
    if ( is_wp_error( $result ) ) {
        throw new Exception( $result->get_error_message() );
    }
} catch ( Exception $e ) {
    $order->add_order_note( 'Payment failed: ' . $e->getMessage() );
    wc_add_notice( 'Payment processing error', 'error' );
    return array( 'result' => 'failure' );
}
```

### Protokollierung

```php
// Add logging for debugging
if ( $this->debug ) {
    $this->log( 'Payment processing started for order ' . $order_id );
}

private function log( $message ) {
    if ( empty( $this->logger ) ) {
        $this->logger = wc_get_logger();
    }
    $this->logger->info( $message, array( 'source' => $this->id ) );
}
```

## Testen Ihres Gateways

### Entwicklungsumgebung

1. **Testmodus**: Implementieren Sie immer einen Test/Sandbox-Modus
2. **Debug-Protokollierung**: Fügen Sie umfangreiche Protokollierung für die Fehlersuche hinzu
3. **Fehler-Szenarien**: Testen Sie verschiedene Fehlersituationen
4. **POS-Tests**: Testen Sie speziell in der POS-Umgebung

### Testfälle

- **Erfolgreiche Zahlungen**: Überprüfen Sie, ob Bestellungen korrekt abgeschlossen werden
- **Fehlgeschlagene Zahlungen**: Sicherstellen, dass die Fehlerbehandlung korrekt erfolgt
- **Rückerstattungen**: Testen Sie die Rückerstattungsfunktionalität, falls unterstützt
- **Grenzfälle**: Testen Sie mit verschiedenen Bestellbeträgen und Konfigurationen

## Bereitstellung

### Plugin-Paketierung

1. **Entwicklungsdateien entfernen**: Bereinigen Sie Testdateien und Entwicklungstools
2. **Versionskontrolle**: Aktualisieren Sie die Versionsnummern im Plugin-Header
3. **Dokumentation**: Fügen Sie README mit Installationsanweisungen hinzu
4. **Zip-Paket erstellen**: Erstellen Sie eine installierbare Zip-Datei

### Verteilung

- **GitHub-Releases**: Verwenden Sie GitHub-Releases zur Versionsverwaltung
- **WordPress-Plugin-Verzeichnis**: Ziehen Sie in Betracht, es bei WordPress.org einzureichen
- **Private Verteilung**: Hosten Sie es bei Bedarf auf Ihren eigenen Servern

## Erweiterte Funktionen

### Webhooks

Für Echtzeit-Zahlungsupdates:

```php
public function handle_webhook() {
    $payload = file_get_contents( 'php://input' );
    $data = json_decode( $payload, true );
    
    // Verify webhook signature
    if ( $this->verify_webhook_signature( $payload ) ) {
        $this->process_webhook_data( $data );
    }
}
```

### Unterstützung für Abonnements

Für wiederkehrende Zahlungen:

```php
// Add subscription support
$this->supports[] = 'subscriptions';
$this->supports[] = 'subscription_cancellation';
$this->supports[] = 'subscription_suspension';
```

### Mehrwährung

Für internationale Zahlungen:

```php
public function get_supported_currencies() {
    return array( 'USD', 'EUR', 'GBP', 'CAD' );
}
```

## Ressourcen

### Dokumentation

- [WooCommerce-Zahlungsgateway-API](https://woocommerce.github.io/code-reference/classes/WC-Payment-Gateway.html)
- [WordPress-Plugin-Entwicklung](https://developer.wordpress.org/plugins/)
- [WooCommerce POS-Dokumentation](https://docs.wcpos.com/)

### Vorlagen-Repository

- **GitHub**: [woocommerce-gateway-template](https://github.com/wcpos/woocommerce-gateway-template)
- **Probleme**: Berichten Sie über Vorlagenprobleme oder fordern Sie Funktionen an
- **Beiträge**: Reichen Sie Verbesserungen über Pull-Requests ein

### Hilfe erhalten

Für Entwicklungsunterstützung:
- Besuchen Sie das [GitHub-Repository](https://github.com/wcpos/woocommerce-gateway-template) für vorlagenbezogene Probleme
- Überprüfen Sie die WooCommerce-Entwicklerdokumentation für API-Fragen
- Treten Sie der WooCommerce-Entwicklergemeinschaft für allgemeine Anleitung bei

## Beispiel-Gateways

Studieren Sie diese vorhandenen benutzerdefinierten Gateways für Implementierungsbeispiele:

- **[Stripe Terminal](./stripe-terminal)**: Hardware-Integrationsbeispiel
- **[SumUp Terminal](./sumup-terminal)**: API-basierte Terminal-Integration
- **[E-Mail-Rechnung](./email-invoice)**: Einfaches, E-Mail-basiertes Gateway
- **[Web-Checkout](./web-checkout)**: Web-Integrationsgateway