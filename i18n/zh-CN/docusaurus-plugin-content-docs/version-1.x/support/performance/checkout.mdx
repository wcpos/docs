---
title: 结账性能
sidebar_label: 结账性能
sidebar_position: 1
---

import Image from "@theme/IdealImage";

如果您在结账过程中遇到性能缓慢的问题，本指南将帮助您识别和解决最常见的原因。

## WCPOS 结账工作原理

WCPOS 结账会打开一个包含 iframe/webview 的模态窗口，加载精简版的 WooCommerce 订单支付模板。这基本上是顾客在网上支付订单时看到的[客户支付页面](https://woocommerce.com/document/managing-orders/paying-for-orders/#customer-payment-page-link)。

:::info 开发者注
您可以在 WCPOS 插件库中查看结账模板：[templates/payment.php](https://github.com/wcpos/woocommerce-pos/blob/main/templates/payment.php)
:::

## 内置优化

WCPOS 包含多种优化，以提高结账性能：

- **精简模板** - 删除不必要的主题元素和杂乱内容
- **选择性脚本/样式加载** - 仅加载必要的脚本和样式
- **最小的 DOM 结构** - 减少结账页面的复杂性

然而，一些脚本和样式无法完全禁用，因为支付网关可能需要它们正常工作。

## 常见性能问题

### 1. 不必要的脚本和样式

**问题：** 主题和插件添加了不需要的脚本和样式，导致页面加载时间变慢。

**解决方案：** 使用[结账设置](/pos/checkout#checkout-settings-troubleshooting)禁用不必要的资源：

1. 点击结账模态窗口中的**结账设置**按钮
2. 首先尝试禁用主题样式：
   - wp-block-library
   - classic-theme-styles
   - 你主题的自定义样式
3. 禁用非必要的 WooCommerce 脚本：
   - wc-add-to-cart
   - selectWoo（如果网关不需要）
   - html5shiv

<div class="image-container">
  <Image
    alt="禁用所有样式和脚本的表单"
    img="/img/disable-styles-and-scripts.png"
    style={{ maxHeight: 600 }}
  />
  <p class="image-caption">禁用所有样式和脚本的表单</p>
</div>

:::warning 请小心
不要禁用支付网关所需的脚本。如果在禁用脚本后某种支付方式停止工作，请重新启用它。
:::

### 2. 插件在订单创建期间干扰

**问题：** 钩入订单创建过程的插件可能会导致显著延迟。例如，像 Xero 这样的会计插件可能会将订单数据发送到外部服务器，阻塞结账过程。

**故障排除步骤：**

1. **在暂存服务器上测试** - 如果您有一个暂存服务器，请禁用除 WooCommerce 和 WCPOS 之外的所有插件
2. **测试结账速度** - 处理一个测试订单并记录性能
3. **逐个启用插件** - 如果性能大幅改善，逐个启用插件以识别问题插件
4. **联系插件开发者** - 如果某个特定插件导致问题，请联系开发者寻求优化建议

**常见问题插件类型：**
- 会计/记账集成（Xero，QuickBooks）
- 在创建订单时触发的电子邮件营销工具
- 库存管理系统
- 复杂的运费计算器
- 第三方分析工具

### 3. 服务器资源限制

**问题：** 如果您的服务器负载过重或缺乏足够的资源，所有操作（包括结账）都会变慢。

**监控和解决方案：**

1. **监控服务器性能：**
   - 结账期间的 CPU 使用率
   - 内存消耗
   - 数据库查询性能
   - 网络延迟

2. **优化服务器资源：**
   - 增加 PHP 内存限制
   - 优化数据库查询
   - 使用缓存插件（但测试兼容性）
   - 考虑升级托管计划

3. **数据库优化：**
   - 清理旧订单数据
   - 优化数据库表
   - 删除不必要的插件和主题

## WordPress 开发者最佳实践

:::tip 针对开发者
WordPress 开发者应使用 `wp_enqueue_scripts` 来正确添加脚本和样式到页面。不幸的是，一些插件和主题开发者没有遵循最佳实践，而是直接在模板中插入代码，使得很难轻易地取消排队这些资源。
:::

如果您遇到无法通过结账设置禁用的脚本或样式的问题：

1. **联系开发者** - 请他们遵循 WordPress 编码标准
2. **使用子主题** - 在子主题中覆盖问题模板
3. **自定义钩子** - 使用 WordPress 钩子在结账页面上移除问题代码

## 性能测试

要测试结账性能的改进：

1. **基准测量** - 在进行更改之前，测量结账所需时间
2. **每次更改一次** - 这有助于识别对性能影响最大的更改
3. **使用真实的支付网关测试** - 不仅测试现金支付
4. **在不同设备上测试** - 移动设备可能会显示不同的性能特征

## 快速改善

以下是您可以进行的最有效的性能改进：

1. **禁用主题样式** - 通常提供最大的改进
2. **移除不必要的 WooCommerce 脚本** - 减少 JavaScript 执行时间
3. **审计订单创建钩子** - 识别和优化慢插件
4. **优化图像** - 确保结账中的任何图像都是优化过的
5. **使用性能监控插件** - 随时间跟踪改进

## 何时寻求帮助

如果：

- 结账持续超过 10 秒
- 您已经遵循本指南但仍然遇到问题
- 您怀疑某个特定插件但无法识别
- 您需要帮助优化服务器资源

## 相关文档

- [结账设置](/pos/checkout#checkout-settings-troubleshooting) - 禁用有问题的脚本和样式
- [支付方式](/payment) - 配置支付网关以获得最佳性能
- [故障排除](/category/troubleshooting) - 一般故障排除指南