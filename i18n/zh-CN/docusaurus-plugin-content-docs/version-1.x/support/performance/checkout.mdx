---
title: 结账性能
sidebar_label: 结账性能
sidebar_position: 1
---

import Image from "@theme/IdealImage";

如果您在结账过程中遇到性能缓慢的问题，本指南将帮助您识别和解决最常见的原因。

## WCPOS 结账如何工作

WCPOS 结账打开一个模态框，其中嵌入了一个加载 WooCommerce 订单支付模板简化版的 iframe/webview。这基本上与客户在线支付订单时看到的 [客户支付页面](https://woocommerce.com/document/managing-orders/paying-for-orders/#customer-payment-page-link) 是相同的页面。

:::info Developer Note
您可以在 WCPOS 插件仓库中查看结账模板：[templates/payment.php](https://github.com/wcpos/woocommerce-pos/blob/main/templates/payment.php)
:::

## 内置优化

WCPOS 包含多项优化措施以提高结账性能：

- **简化模板** - 移除不必要的主题元素和杂乱
- **选择性加载脚本/样式** - 仅加载必要的脚本和样式
- **最小化 DOM 结构** - 减少结账页面的复杂性

然而，一些脚本和样式无法完全禁用，因为支付网关可能需要它们正常运行。

## 常见性能问题

### 1. 不必要的脚本和样式

**问题：** 主题和插件添加了不需要的脚本和样式，从而减慢了页面加载时间。

**解决方案：** 使用 [结账设置](/pos/checkout#checkout-settings-troubleshooting) 来禁用不必要的资源：

1. 点击结账模态框中的 **结账设置** 按钮
2. 尝试先禁用主题样式：
   - wp-block-library
   - classic-theme-styles
   - 您主题的自定义样式
3. 禁用非必要的 WooCommerce 脚本：
   - wc-add-to-cart
   - selectWoo（如果您的网关不需要）
   - html5shiv

<div class="image-container">
  <Image
    alt="禁用所有样式和脚本的表单"
    img="/img/disable-styles-and-scripts.png"
    style={{ maxHeight: 600 }}
  />
  <p class="image-caption">禁用所有样式和脚本的表单</p>
</div>

:::warning 小心
不要禁用您的支付网关所需的脚本。如果在禁用某个脚本后支付方式停止工作，请重新启用它。
:::

### 2. 插件干扰订单创建

**问题：** 插件在订单创建过程中钩入会造成显著延迟。例如，像 Xero 这样的会计插件可能会将订单数据发送到外部服务器，阻塞结账过程。

**故障排除步骤：**

1. **在临时环境中测试** - 如果您有一个临时服务器，禁用除 WooCommerce 和 WCPOS 之外的所有插件
2. **测试结账速度** - 处理一个测试订单，记录性能
3. **逐步启用插件** - 如果性能显著提高，逐个重新启用插件以确定问题插件
4. **联系插件开发者** - 如果某个特定插件造成问题，请联系开发者寻求优化建议

**常见问题插件类型：**
- 会计/簿记集成（Xero、QuickBooks）
- 在订单创建时触发的邮件营销工具
- 库存管理系统
- 复杂的运输计算器
- 第三方分析工具

### 3. 服务器资源限制

**问题：** 如果您的服务器负载较高或资源不足，包括结账在内的所有操作都会变得缓慢。

**监控和解决方案：**

1. **监控服务器性能：**
   - 结账期间 CPU 使用率
   - 内存消耗
   - 数据库查询性能
   - 网络延迟

2. **优化服务器资源：**
   - 增加 PHP 内存限制
   - 优化数据库查询
   - 使用缓存插件（但需测试兼容性）
   - 考虑升级主机计划

3. **数据库优化：**
   - 清理旧订单数据
   - 优化数据库表
   - 删除不必要的插件和主题

## WordPress 开发者最佳实践

:::tip 对开发者的提示
WordPress 开发者应使用 `wp_enqueue_scripts` 正确地将脚本和样式添加到页面中。不幸的是，一些插件和主题开发者没有遵循最佳实践，直接将代码插入模板中，使得无法轻松地取消排队加载这些资源。
:::

如果您遇到无法通过结账设置禁用的脚本或样式的问题：

1. **联系开发者** - 请他们遵循 WordPress 编码标准
2. **使用子主题** - 在子主题中重写有问题的模板
3. **自定义钩子** - 使用 WordPress 钩子在结账页面上删除有问题的代码

## 性能测试

为了测试结账性能的提升：

1. **基线测量** - 在进行更改前测量结账所需的时间
2. **一次进行一个更改** - 这有助于识别哪些更改产生了最大影响
3. **使用真实的支付网关测试** - 不仅仅用现金支付进行测试
4. **在不同设备上测试** - 移动设备可能会展现不同的性能特征

## 快速改善

以下是您可以进行的最有效的性能提升措施：

1. **禁用主题样式** - 通常会带来最大的改善
2. **删除不必要的 WooCommerce 脚本** - 减少 JavaScript 执行时间
3. **审核订单创建钩子** - 识别和优化运行缓慢的插件
4. **优化图像** - 确保结账中的任何图像都经过优化
5. **使用性能监控插件** - 追踪长期改善情况

## 何时寻求帮助

请联系 WCPOS 支持，若：

- 结账时间持续超过 10 秒
- 您遵循了本指南但仍然遇到问题
- 您怀疑某个特定插件，但无法确定它
- 您需要帮助优化服务器资源

## 相关文档

- [结账设置](/pos/checkout#checkout-settings-troubleshooting) - 禁用问题脚本和样式
- [支付方式](/payment) - 配置支付网关以实现最佳性能
- [故障排除](/category/troubleshooting) - 一般故障排除指南

---