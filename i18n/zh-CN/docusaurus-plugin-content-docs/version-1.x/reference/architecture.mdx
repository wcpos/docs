---
title: 架构
sidebar_label: 架构
sidebar_position: 2
---

import LocalizedSVG from '@site/src/components/LocalizedSVG';

本页面为开发者和高级用户解释WCPOS的技术架构。

## 双部分系统

WCPOS被设计为双部分系统：

1. **PHP 插件：** 托管在您的服务器上，这是一个相对较小的插件，用于扩展 [WooCommerce REST API](/reference/wc-rest-api)。

2. **JavaScript 客户端：** 在浏览器或桌面应用中本地运行，未来还将支持iOS和Android应用。

可以将其视为两个独立的世界：

- _PHP世界_ 是使用WordPress和WooCommerce进行数据管理的地方。
- _JavaScript世界_ 在本地复制您的WooCommerce商店，针对快速搜索和离线使用进行了优化。

<LocalizedSVG svgName="pos-client-woo-server" />

## 数据同步

数据通过 [WooCommerce REST API](https://woocommerce.github.io/woocommerce-rest-api-docs/) 获取。这意味着POS必须下载每个产品、变体、产品类别、客户、税率等，并将它们本地存储。

尽管初始下载可能耗时，但一旦下载完成，就可以立即访问这些数据，无需不断从服务器获取。

### 同步内容

- 产品和变体
- 产品类别和标签
- 客户
- 税率和税收类别
- 支付网关（用于结账）
- 订单（对于专业版中的订单历史）

### 同步策略

WCPOS使用增量同步策略：

1. **初始同步：** 首次加载时下载所有数据
2. **增量更新：** 仅获取自上次同步以来的变更
3. **后台同步：** 定期检查更新
4. **手动同步：** 用户可随时触发同步

## 架构优缺点

| 优点 😊 | 缺点 😟 |
| ------------------------------------------------------------------ | -------------------------------------------------------- |
| 本地数据搜索瞬间完成 | 保持数据同步具有挑战性 |
| 离线时可用缓存数据 | 受WooCommerce REST API限制 |
| 能够为桌面、iOS和Android创建更好的原生应用 | WordPress主题和钩子无法自定义POS应用 |

## 本地数据库

JavaScript客户端使用IndexedDB（浏览器内置数据库）存储数据。这提供了：

- **持久性：** 数据在浏览器重启后仍然保存
- **性能：** 快速查询，无网络延迟
- **离线浏览：** 缓存数据在无网络时仍可访问

## 结账架构

结账过程使用iframe/webview加载WooCommerce订单支付页面。这种方法：

- **利用现有支付网关：** 任何WooCommerce支付网关都可以在POS中使用
- **保持安全性：** 支付处理通过WooCommerce安全基础设施进行
- **降低复杂性：** 无需重新实现支付网关集成

## API扩展

PHP插件通过为POS特定功能添加额外端点来扩展WooCommerce REST API。详情请参见 [WooCommerce REST API](/reference/wc-rest-api)。