---
title: "API04003：JSON响应格式错误"
sidebar_label: API04003
---

# API04003：JSON响应格式错误

## 含义

服务器返回的看似是JSON的数据实际上已损坏或无效。由于JSON语法错误，POS无法解析响应。

## 常见原因

- **PHP通知/警告** — JSON前的PHP输出
- **BOM（字节顺序标记）** — 文件开头的不可见字符
- **编码问题** — 字符编码错误
- **响应截断** — 传输过程中响应被切断
- **插件输出** — 插件添加了非JSON内容

## 解决方法

### 1. 检查PHP通知

PHP通知/警告会破坏JSON解析：

在 `wp-config.php` 中：
```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
```

查看 `wp-content/debug.log` 并修复任何问题。

### 2. 检查BOM字符

某些文本编辑器会添加不可见的BOM字符：
- 重新保存PHP文件，不使用BOM
- 使用不带BOM的UTF-8编码
- 检查最近编辑的文件

### 3. 验证完整响应

如果响应被截断：
- 检查PHP输出缓冲设置
- 增加 php.ini 中的 `output_buffering`
- 检查超时问题

### 4. 直接测试API

在浏览器或使用curl：
```bash
curl -v https://yoursite.com/wp-json/wcpos/v1/
```

查看JSON之前是否有意外内容。

### 5. 检查字符编码

确保数据库和PHP使用UTF-8：
- 检查 `wp-config.php` 的字符集设置
- 验证数据库表是UTF-8
- 查找可能导致问题的特殊字符

## 相关错误

- [API04001](./API04001) — 响应格式无效
- [API04005](./API04005) — 尝试恢复JSON