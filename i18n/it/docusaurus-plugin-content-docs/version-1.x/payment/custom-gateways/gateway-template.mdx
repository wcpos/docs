---
title: "Template di Gateway"
description: "Crea il tuo gateway di pagamento personalizzato per WooCommerce POS"
---

import FeatureCard from '@site/src/components/FeatureCard';
import FeatureGrid from '@site/src/components/FeatureGrid';

# Template di Gateway {#gateway-template}

Il Template di Gateway per WooCommerce fornisce un punto di partenza per creare i propri gateway di pagamento personalizzati per WooCommerce POS. Questo template include tutto il codice di base necessario e la struttura per costruire un gateway di pagamento completamente funzionale.

## Caratteristiche {#features}

<FeatureGrid>
  <FeatureCard icon="code" title="Template Completo">
    Struttura del gateway pronta all'uso con tutti i metodi richiesti
  </FeatureCard>
  <FeatureCard icon="store" title="Integrazione POS">
    Pre-configurata per la compatibilità con WooCommerce POS
  </FeatureCard>
  <FeatureCard icon="terminal" title="Impostazione Automatica">
    Personalizzazione del template basata su script
  </FeatureCard>
  <FeatureCard icon="puzzle-piece" title="Estensibile">
    Facile da modificare ed estendere per fornitori di pagamento specifici
  </FeatureCard>
</FeatureGrid>

## Introduzione {#getting-started}

### Opzione 1: Generazione Automatica del Template {#option-1-automated-template-generation}

Il template include uno script che personalizza automaticamente il template per il tuo specifico gateway:

1. **Clona il Repository**:
   ```bash
   git clone https://github.com/wcpos/woocommerce-gateway-template.git
   cd woocommerce-gateway-template
   ```

2. **Esegui lo Script di Setup**:
   ```bash
   ./create-gateway.sh
   ```

3. **Segui i Prompt**:
   - Inserisci il nome del tuo gateway (es. "Il Mio Gateway di Pagamento")
   - Inserisci uno slug per il gateway (es. "il-mio-pagamento")
   - Fornisci una descrizione
   - Lo script genererà un plugin personalizzato

### Opzione 2: Utilizzo Manuale del Template {#option-2-manual-template-usage}

Se preferisci la personalizzazione manuale:

1. **Scarica il Template**:
   - Visita il [repository del Template di Gateway](https://github.com/wcpos/woocommerce-gateway-template)
   - Scarica l'ultima versione o clona il repository

2. **Personalizza il Template**:
   - Sostituisci `{{GATEWAY_NAME}}` con il nome visualizzato del tuo gateway
   - Sostituisci `{{GATEWAY_SLUG}}` con l'identificativo unico del tuo gateway
   - Sostituisci `{{GATEWAY_DESCRIPTION}}` con la descrizione del tuo gateway

3. **Rinomina i File**:
   - Rinomina `wcpos-{{GATEWAY_SLUG}}.php` per abbinare il tuo slug di gateway
   - Aggiorna gli header dei file e le informazioni sul plugin

## Struttura del Template {#template-structure}

### File Principale del Plugin {#main-plugin-file}

Il file principale del plugin (`wcpos-{{GATEWAY_SLUG}}.php`) contiene:

- **Header del Plugin**: Informazioni sul plugin WordPress
- **Classe del Gateway**: Classe principale del gateway di pagamento
- **Inizializzazione**: Setup del plugin e hook
- **Integrazione**: Compatibilità con WooCommerce POS

### Componenti Chiave {#key-components}

**Struttura della Classe del Gateway**:
```php
class WCPOS_Gateway_{{GATEWAY_CLASS}} extends WC_Payment_Gateway {
    // Gateway configuration
    public function __construct() { }
    
    // Admin settings form
    public function init_form_fields() { }
    
    // Process payment (main logic goes here)
    public function process_payment( $order_id ) { }
    
    // POS-specific methods
    public function payment_fields() { }
}
```

## Guida alla Personalizzazione {#customisation-guide}

### Configurazione di Base {#basic-configuration}

1. **Informazioni sul Gateway**:
   ```php
   $this->id = 'your_gateway_id';
   $this->title = 'Your Gateway Name';
   $this->description = 'Gateway description for customers';
   $this->method_title = 'Admin title';
   $this->method_description = 'Admin description';
   ```

2. **Caratteristiche Supportate**:
   ```php
   $this->supports = array(
       'products',
       'refunds',
       'subscriptions', // if applicable
   );
   ```

### Elaborazione dei Pagamenti {#payment-processing}

La logica principale del pagamento va nel metodo `process_payment()`:

```php
public function process_payment( $order_id ) {
    $order = wc_get_order( $order_id );
    
    // Your payment processing logic here
    // Example: API calls, validation, etc.
    
    if ( $payment_successful ) {
        $order->payment_complete();
        return array(
            'result' => 'success',
            'redirect' => $this->get_return_url( $order )
        );
    } else {
        wc_add_notice( 'Payment failed', 'error' );
        return array(
            'result' => 'failure'
        );
    }
}
```

### Impostazioni dell'Amministratore {#admin-settings}

Configura le impostazioni dell'amministratore in `init_form_fields()`:

```php
public function init_form_fields() {
    $this->form_fields = array(
        'enabled' => array(
            'title' => 'Enable/Disable',
            'type' => 'checkbox',
            'label' => 'Enable Your Gateway',
            'default' => 'yes'
        ),
        'api_key' => array(
            'title' => 'API Key',
            'type' => 'text',
            'description' => 'Enter your API key',
            'default' => '',
            'desc_tip' => true,
        ),
        // Add more settings as needed
    );
}
```

### Integrazione POS {#pos-integration}

Per funzionalità specifiche del POS, implementa:

```php
public function payment_fields() {
    // Custom payment form for POS
    if ( is_admin() && isset( $_GET['page'] ) && $_GET['page'] === 'wc-pos' ) {
        // POS-specific payment fields
        echo '<div class="pos-payment-fields">';
        // Your custom POS interface
        echo '</div>';
    } else {
        // Standard web checkout fields
        parent::payment_fields();
    }
}
```

## Migliori Pratiche di Sviluppo {#development-best-practices}

### Standard di Codice {#code-standards}

- **Standard di Codifica di WordPress**: Segui gli standard di codifica PHP di WordPress
- **Linee Guida di WooCommerce**: Attieniti alle pratiche di sviluppo di WooCommerce
- **Sicurezza**: Sanitizza gli input, valida i dati, utilizza i nonce
- **Internazionalizzazione**: Rendi le stringhe traducibili usando `__()` e `_e()`

### Gestione degli Errori {#error-handling}

```php
// Proper error handling
try {
    $result = $this->process_api_call( $data );
    if ( is_wp_error( $result ) ) {
        throw new Exception( $result->get_error_message() );
    }
} catch ( Exception $e ) {
    $order->add_order_note( 'Payment failed: ' . $e->getMessage() );
    wc_add_notice( 'Payment processing error', 'error' );
    return array( 'result' => 'failure' );
}
```

### Logging

```php
// Add logging for debugging
if ( $this->debug ) {
    $this->log( 'Payment processing started for order ' . $order_id );
}

private function log( $message ) {
    if ( empty( $this->logger ) ) {
        $this->logger = wc_get_logger();
    }
    $this->logger->info( $message, array( 'source' => $this->id ) );
}
```

## Testa il Tuo Gateway {#testing-your-gateway}

### Ambiente di Sviluppo {#development-environment}

1. **Modalità di Test**: Implementa sempre una modalità di test/sandbox
2. **Logging di Debug**: Inclusi logging dettagliati per la risoluzione dei problemi
3. **Scenari di Errore**: Testa varie condizioni di errore
4. **Testing POS**: Testa specificamente nell'ambiente POS

### Casi di Test {#test-cases}

- **Pagamenti Riuciti**: Verifica che gli ordini si completino correttamente
- **Pagamenti Falliti**: Assicurati che ci sia una corretta gestione degli errori
- **Rimborsi**: Testa la funzionalità di rimborso se supportata
- **Casi Limite**: Testa con vari importi dell'ordine e configurazioni

## Distribuzione {#deployment}

### Imballaggio del Plugin {#plugin-packaging}

1. **Rimuovi i File di Sviluppo**: Pulisci file di test e strumenti di sviluppo
2. **Controllo Versioni**: Aggiorna i numeri di versione nell'header del plugin
3. **Documentazione**: Includi README con le istruzioni di installazione
4. **Pacchetto Zip**: Crea un file zip installabile

### Distribuzione {#distribution}

- **Rifiniture di GitHub**: Usa le rifiniture di GitHub per la gestione delle versioni
- **Directory dei Plugin di WordPress**: Considera di inviare a WordPress.org
- **Distribuzione Privata**: Ospita sui tuoi server se necessario

## Funzionalità Avanzate {#advanced-features}

### Webhook {#webhooks}

Per aggiornamenti di pagamento in tempo reale:

```php
public function handle_webhook() {
    $payload = file_get_contents( 'php://input' );
    $data = json_decode( $payload, true );
    
    // Verify webhook signature
    if ( $this->verify_webhook_signature( $payload ) ) {
        $this->process_webhook_data( $data );
    }
}
```

### Supporto per Abbonamenti {#subscriptions-support}

Per pagamenti ricorrenti:

```php
// Add subscription support
$this->supports[] = 'subscriptions';
$this->supports[] = 'subscription_cancellation';
$this->supports[] = 'subscription_suspension';
```

### Multi-valuta {#multi-currency}

Per pagamenti internazionali:

```php
public function get_supported_currencies() {
    return array( 'USD', 'EUR', 'GBP', 'CAD' );
}
```

## Risorse {#resources}

### Documentazione {#documentation}

- [API del Gateway di Pagamento WooCommerce](https://woocommerce.github.io/code-reference/classes/WC-Payment-Gateway.html)
- [Sviluppo di Plugin per WordPress](https://developer.wordpress.org/plugins/)
- [Documentazione WooCommerce POS](https://docs.wcpos.com/)

### Repository del Template {#template-repository}

- **GitHub**: [woocommerce-gateway-template](https://github.com/wcpos/woocommerce-gateway-template)
- **Problemi**: Riporta problematiche del template o richiedi funzionalità
- **Contributi**: Invia miglioramenti tramite pull request

### Richiesta di Aiuto {#getting-help}

Per supporto nello sviluppo:
- Visita il [repository GitHub](https://github.com/wcpos/woocommerce-gateway-template) per problematiche specifiche del template
- Controlla la documentazione degli sviluppatori di WooCommerce per domande sull’API
- Unisciti alla comunità degli sviluppatori di WooCommerce per guida generale

## Gateway di Esempio {#example-gateways}

Studia questi gateway personalizzati esistenti per esempi di implementazione:

- **[Stripe Terminal](./stripe-terminal)**: Esempio di integrazione hardware
- **[SumUp Terminal](./sumup-terminal)**: Integrazione del terminale basata su API
- **[Email Invoice](./email-invoice)**: Gateway semplice basato su email
- **[Web Checkout](./web-checkout)**: Gateway di integrazione web