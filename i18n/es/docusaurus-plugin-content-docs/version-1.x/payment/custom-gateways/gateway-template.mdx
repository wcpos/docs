---
title: "Plantilla de Gateway"
description: "Crea tu propia pasarela de pago personalizada de WooCommerce POS"
---

import FeatureCard from '@site/src/components/FeatureCard';
import FeatureGrid from '@site/src/components/FeatureGrid';

# Plantilla de Gateway {#gateway-template}

La Plantilla de Gateway de WooCommerce proporciona un punto de partida para crear tus propias pasarelas de pago personalizadas para WooCommerce POS. Esta plantilla incluye todo el código de boilerplate necesario y la estructura para construir una pasarela de pago completamente funcional.

## Características {#features}

<FeatureGrid>
  <FeatureCard icon="code" title="Plantilla Completa">
    Estructura de gateway lista para usar con todos los métodos requeridos
  </FeatureCard>
  <FeatureCard icon="store" title="Integración POS">
    Preconfigurado para la compatibilidad con WooCommerce POS
  </FeatureCard>
  <FeatureCard icon="terminal" title="Configuración Automatizada">
    Personalización del template basada en scripts
  </FeatureCard>
  <FeatureCard icon="puzzle-piece" title="Extensible">
    Fácil de modificar y ampliar para proveedores de pago específicos
  </FeatureCard>
</FeatureGrid>

## Comenzando {#getting-started}

### Opción 1: Generación Automatizada de Plantillas {#option-1-automated-template-generation}

La plantilla incluye un script que personaliza automáticamente la plantilla para tu gateway específico:

1. **Clona el Repositorio**:
   ```bash
   git clone https://github.com/wcpos/woocommerce-gateway-template.git
   cd woocommerce-gateway-template
   ```

2. **Ejecuta el Script de Configuración**:
   ```bash
   ./create-gateway.sh
   ```

3. **Sigue las Indicaciones**:
   - Ingresa el nombre de tu gateway (por ejemplo, "Mi Pasarela de Pago")
   - Ingresa un slug de gateway (por ejemplo, "mi-pago")
   - Proporciona una descripción
   - El script generará un plugin personalizado

### Opción 2: Uso Manual de la Plantilla {#option-2-manual-template-usage}

Si prefieres la personalización manual:

1. **Descarga la Plantilla**:
   - Visita el [repositorio de Plantilla de Gateway](https://github.com/wcpos/woocommerce-gateway-template)
   - Descarga la última versión o clona el repositorio

2. **Personaliza la Plantilla**:
   - Reemplaza `{{GATEWAY_NAME}}` con el nombre que se mostrará de tu gateway
   - Reemplaza `{{GATEWAY_SLUG}}` con el identificador único de tu gateway
   - Reemplaza `{{GATEWAY_DESCRIPTION}}` con la descripción de tu gateway

3. **Renombra Archivos**:
   - Renombra `wcpos-{{GATEWAY_SLUG}}.php` para que coincida con el slug de tu gateway
   - Actualiza los encabezados de archivo e información del plugin

## Estructura de la Plantilla {#template-structure}

### Archivo Principal del Plugin {#main-plugin-file}

El archivo principal del plugin (`wcpos-{{GATEWAY_SLUG}}.php`) contiene:

- **Encabezado del Plugin**: Información del plugin de WordPress
- **Clase de Gateway**: Clase principal de la pasarela de pago
- **Inicialización**: Configuración del plugin y hooks
- **Integración**: Compatibilidad con WooCommerce POS

### Componentes Clave {#key-components}

**Estructura de la Clase de Gateway**:
```php
class WCPOS_Gateway_{{GATEWAY_CLASS}} extends WC_Payment_Gateway {
    // Gateway configuration
    public function __construct() { }
    
    // Admin settings form
    public function init_form_fields() { }
    
    // Process payment (main logic goes here)
    public function process_payment( $order_id ) { }
    
    // POS-specific methods
    public function payment_fields() { }
}
```

## Guía de Personalización {#customisation-guide}

### Configuración Básica {#basic-configuration}

1. **Información de Gateway**:
   ```php
   $this->id = 'your_gateway_id';
   $this->title = 'Your Gateway Name';
   $this->description = 'Gateway description for customers';
   $this->method_title = 'Admin title';
   $this->method_description = 'Admin description';
   ```

2. **Características Soportadas**:
   ```php
   $this->supports = array(
       'products',
       'refunds',
       'subscriptions', // if applicable
   );
   ```

### Procesamiento de Pagos {#payment-processing}

La lógica principal de pagos va en el método `process_payment()`:

```php
public function process_payment( $order_id ) {
    $order = wc_get_order( $order_id );
    
    // Your payment processing logic here
    // Example: API calls, validation, etc.
    
    if ( $payment_successful ) {
        $order->payment_complete();
        return array(
            'result' => 'success',
            'redirect' => $this->get_return_url( $order )
        );
    } else {
        wc_add_notice( 'Payment failed', 'error' );
        return array(
            'result' => 'failure'
        );
    }
}
```

### Configuración Administrativa {#admin-settings}

Configura los ajustes administrativos en `init_form_fields()`:

```php
public function init_form_fields() {
    $this->form_fields = array(
        'enabled' => array(
            'title' => 'Enable/Disable',
            'type' => 'checkbox',
            'label' => 'Enable Your Gateway',
            'default' => 'yes'
        ),
        'api_key' => array(
            'title' => 'API Key',
            'type' => 'text',
            'description' => 'Enter your API key',
            'default' => '',
            'desc_tip' => true,
        ),
        // Add more settings as needed
    );
}
```

### Integración POS {#pos-integration}

Para la funcionalidad específica de POS, implementa:

```php
public function payment_fields() {
    // Custom payment form for POS
    if ( is_admin() && isset( $_GET['page'] ) && $_GET['page'] === 'wc-pos' ) {
        // POS-specific payment fields
        echo '<div class="pos-payment-fields">';
        // Your custom POS interface
        echo '</div>';
    } else {
        // Standard web checkout fields
        parent::payment_fields();
    }
}
```

## Mejores Prácticas de Desarrollo {#development-best-practices}

### Estándares de Código {#code-standards}

- **Estándares de Codificación de WordPress**: Sigue los estándares de codificación PHP de WordPress
- **Guías de WooCommerce**: Adhiérete a las prácticas de desarrollo de WooCommerce
- **Seguridad**: Sanea entradas, valida datos, usa nonces
- **Internacionalización**: Haz que las cadenas sean traducibles usando `__()` y `_e()`

### Manejo de Errores {#error-handling}

```php
// Proper error handling
try {
    $result = $this->process_api_call( $data );
    if ( is_wp_error( $result ) ) {
        throw new Exception( $result->get_error_message() );
    }
} catch ( Exception $e ) {
    $order->add_order_note( 'Payment failed: ' . $e->getMessage() );
    wc_add_notice( 'Payment processing error', 'error' );
    return array( 'result' => 'failure' );
}
```

### Registro {#logging}

```php
// Add logging for debugging
if ( $this->debug ) {
    $this->log( 'Payment processing started for order ' . $order_id );
}

private function log( $message ) {
    if ( empty( $this->logger ) ) {
        $this->logger = wc_get_logger();
    }
    $this->logger->info( $message, array( 'source' => $this->id ) );
}
```

## Pruebas de Tu Gateway {#testing-your-gateway}

### Entorno de Desarrollo {#development-environment}

1. **Modo de Prueba**: Implementa siempre un modo de prueba/sandbox
2. **Registro de Depuración**: Incluye registros exhaustivos para solución de problemas
3. **Escenarios de Error**: Prueba diversas condiciones de fallo
4. **Pruebas en POS**: Prueba específicamente en el entorno POS

### Casos de Prueba {#test-cases}

- **Pagos Exitosos**: Verifica que los pedidos se completen correctamente
- **Pagos Fallidos**: Asegúrate de un manejo de errores adecuado
- **Reembolsos**: Prueba la funcionalidad de reembolsos si se admite
- **Casos Límite**: Prueba con diversas cantidades y configuraciones de pedido

## Despliegue {#deployment}

### Empaque del Plugin {#plugin-packaging}

1. **Eliminar Archivos de Desarrollo**: Limpia archivos de prueba y herramientas de desarrollo
2. **Control de Versiones**: Actualiza los números de versión en el encabezado del plugin
3. **Documentación**: Incluye README con instrucciones de instalación
4. **Paquete Zip**: Crea un archivo zip instalable

### Distribución {#distribution}

- **Versiones de GitHub**: Usa versiones de GitHub para la gestión de versiones
- **Directorio de Plugins de WordPress**: Considera enviar a WordPress.org
- **Distribución Privada**: Alojalo en tus propios servidores si es necesario

## Características Avanzadas {#advanced-features}

### Webhooks

Para actualizaciones de pago en tiempo real:

```php
public function handle_webhook() {
    $payload = file_get_contents( 'php://input' );
    $data = json_decode( $payload, true );
    
    // Verify webhook signature
    if ( $this->verify_webhook_signature( $payload ) ) {
        $this->process_webhook_data( $data );
    }
}
```

### Soporte a Suscripciones {#subscriptions-support}

Para pagos recurrentes:

```php
// Add subscription support
$this->supports[] = 'subscriptions';
$this->supports[] = 'subscription_cancellation';
$this->supports[] = 'subscription_suspension';
```

### Multi-moneda {#multi-currency}

Para pagos internacionales:

```php
public function get_supported_currencies() {
    return array( 'USD', 'EUR', 'GBP', 'CAD' );
}
```

## Recursos {#resources}

### Documentación {#documentation}

- [API de Pasarela de Pago de WooCommerce](https://woocommerce.github.io/code-reference/classes/WC-Payment-Gateway.html)
- [Desarrollo de Plugins de WordPress](https://developer.wordpress.org/plugins/)
- [Documentación de WooCommerce POS](https://docs.wcpos.com/)

### Repositorio de Plantilla {#template-repository}

- **GitHub**: [woocommerce-gateway-template](https://github.com/wcpos/woocommerce-gateway-template)
- **Problemas**: Reporta problemas de plantilla o solicita funciones
- **Contribuciones**: Envía mejoras a través de pull requests

### Obtener Ayuda {#getting-help}

Para soporte de desarrollo:
- Visita el [repositorio de GitHub](https://github.com/wcpos/woocommerce-gateway-template) para problemas específicos de la plantilla
- Consulta la documentación de desarrollo de WooCommerce para preguntas sobre la API
- Únete a la comunidad de desarrolladores de WooCommerce para orientación general

## Gateways de Ejemplo {#example-gateways}

Estudia estas pasarelas personalizadas existentes para ejemplos de implementación:

- **[Stripe Terminal](./stripe-terminal)**: Ejemplo de integración de hardware
- **[SumUp Terminal](./sumup-terminal)**: Integración de terminal basada en API
- **[Email Invoice](./email-invoice)**: Pasarela simple basada en correo electrónico
- **[Web Checkout](./web-checkout)**: Pasarela de integración web